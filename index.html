import html2canvas from "html2canvas";
import { useEffect, useRef, useState } from "react";

export default function Home() {
  const [imageUrl, setImageUrl] = useState("");
  const [background, setBackground] = useState("white");
  const imageRef = useRef(null);
  const captureRef = useRef(null);

  const handleCapture = () => {
    if (!captureRef.current) return;

    html2canvas(captureRef.current, { backgroundColor: null, width: 1400, height: 500 }).then((canvas) => {
      const link = document.createElement("a");
      link.download = "capture.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  };

  const handleImageChange = (e) => {
    setImageUrl(e.target.value);
  };

  const handleBackgroundChange = (bg) => {
    setBackground(bg);
  };

  return (
    <div className="min-h-screen bg-neutral-100 p-4">
      <div className="mb-4">
        <input
          type="text"
          value={imageUrl}
          onChange={handleImageChange}
          placeholder="이미지 주소를 입력하세요"
          className="p-2 border rounded w-full mb-2"
        />
        <div className="flex gap-2">
          {[
            { name: "white", label: "흰 배경" },
            { name: "black", label: "검정 배경" },
            { name: "transparent", label: "투명 배경" },
          ].map(({ name, label }) => (
            <button
              key={name}
              onClick={() => handleBackgroundChange(name)}
              className={`px-4 py-2 rounded transition-all ${
                background === name ? "bg-[#191919] text-white" : "bg-gray-200 text-black"
              }`}
            >
              {label}
            </button>
          ))}
        </div>
      </div>

      <div className="mb-4">
        <button
          onClick={handleCapture}
          className="bg-blue-500 text-white px-4 py-2 rounded"
        >
          이미지 다운로드
        </button>
      </div>

      <div
        ref={captureRef}
        style={{
          backgroundColor:
            background === "transparent"
              ? "rgba(0,0,0,0)"
              : background === "black"
              ? "#000"
              : "#fff",
          width: "1400px",
          height: "500px",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          position: "relative",
        }}
      >
        {imageUrl ? (
          <img
            ref={imageRef}
            src={imageUrl}
            alt="미리보기 이미지"
            style={{
              maxWidth: "100%",
              maxHeight: "100%",
              objectFit: "contain",
            }}
            onError={() => alert("이미지를 불러올 수 없습니다. 이미지 주소를 확인해주세요.")}
          />
        ) : (
          <span style={{ color: background === "black" ? "#fff" : "#000" }}>
            이미지 주소를 입력하세요
          </span>
        )}
      </div>
    </div>
  );
}
