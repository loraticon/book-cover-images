<script>
  function generateImage() {
    const url = document.getElementById('imageUrl').value;
    const bg = document.getElementById('background').value;
    if (!url) return alert('이미지 URL을 입력하세요.');

    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = function () {
      const canvasWidth = 1400;
      const canvasHeight = 500;
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;

      // 배경색 처리
      if (bg !== 'transparent') {
        ctx.fillStyle = bg;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      } else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      // 이미지 비율 유지하며 크기 조절
      const scale = Math.min(canvasWidth / img.width, canvasHeight / img.height);
      const imgWidth = img.width * scale;
      const imgHeight = img.height * scale;

      // 이미지 위치를 중앙 정렬
      const x = (canvasWidth - imgWidth) / 2;
      const y = (canvasHeight - imgHeight) / 2;

      // ✅ 그림자 효과 적용
      ctx.save();
      ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
      ctx.shadowBlur = 30;
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 20;
      ctx.drawImage(img, x, y, imgWidth, imgHeight);
      ctx.restore();

      // 이미지 다운로드
      const link = document.createElement('a');
      link.download = 'book-cover.png';
      link.href = canvas.toDataURL();
      link.click();

      // 미리보기
      bookImage.src = url;
      bookImage.style.display = 'block';
      bookImage.style.maxHeight = '300px';
    };
    img.onerror = function () {
      alert('이미지를 불러올 수 없습니다. URL을 확인해주세요.');
    };
    img.src = url;
  }
</script>
